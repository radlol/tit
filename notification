local TweenService = game:GetService("TweenService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

local SETTINGS = {
	Width = 300,
	Height = 75,
	CornerRadius = 12,
	TitleSize = 20,
	MessageSize = 16,
	BGColor = Color3.fromRGB(43, 43, 43),
	TitleColor = Color3.fromRGB(255, 255, 255),
	MessageColor = Color3.fromRGB(230, 230, 230),
	AccentColor = Color3.fromRGB(109, 180, 255),
	Gradient = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.fromRGB(179, 238, 255)),
		ColorSequenceKeypoint.new(0.5, Color3.fromRGB(241, 217, 227)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(242, 255, 202)),
	}),
}

local screenGui = CoreGui:FindFirstChild("StyledNotifications")
if not screenGui then
	screenGui = Instance.new("ScreenGui")
	screenGui.Name = "StyledNotifications"
	screenGui.IgnoreGuiInset = true
	screenGui.ResetOnSpawn = false
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
	screenGui.Parent = CoreGui

	local container = Instance.new("Frame")
	container.Name = "Container"
	container.AnchorPoint = Vector2.new(1, 1) -- anchor to bottom-right
	container.Position = UDim2.new(1, -20, 1, -40) -- move up a bit (higher offset)
	container.Size = UDim2.new(0, SETTINGS.Width, 1, -20)
	container.BackgroundTransparency = 1
	container.Parent = screenGui

	local layout = Instance.new("UIListLayout")
	layout.Parent = container
	layout.FillDirection = Enum.FillDirection.Vertical
	layout.HorizontalAlignment = Enum.HorizontalAlignment.Right
	layout.VerticalAlignment = Enum.VerticalAlignment.Bottom -- stack upward from the bottom
	layout.Padding = UDim.new(0, 8)
end

_G.ShowNotification = function(titleText, messageText, duration)
	duration = duration or 5
	local container = screenGui:FindFirstChild("Container")

	local notif = Instance.new("Frame")
	notif.Size = UDim2.new(0, SETTINGS.Width, 0, SETTINGS.Height)
	notif.BackgroundColor3 = SETTINGS.BGColor
	notif.BorderSizePixel = 0
	notif.BackgroundTransparency = 1
	notif.ClipsDescendants = true
	notif.Parent = container

	local corner = Instance.new("UICorner", notif)
	corner.CornerRadius = UDim.new(0, SETTINGS.CornerRadius)

	local stroke = Instance.new("UIStroke", notif)
	stroke.Thickness = 2
	stroke.Transparency = 0.8

	local gradient = Instance.new("UIGradient", notif)
	gradient.Color = SETTINGS.Gradient

	local title = Instance.new("TextLabel")
	title.BackgroundTransparency = 1
	title.Position = UDim2.new(0, 15, 0, 8)
	title.Size = UDim2.new(1, -90, 0, 25)
	title.Font = Enum.Font.SourceSansBold
	title.Text = titleText or "Notification"
	title.TextSize = SETTINGS.TitleSize
	title.TextColor3 = SETTINGS.TitleColor
	title.TextTransparency = 1
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.TextYAlignment = Enum.TextYAlignment.Center
	title.Parent = notif

	if string.match(title.Text, "^[%z\1-\127\194-\244][\128-\191]*") then
		title.Text = title.Text:gsub("^(%S+)", "%1 ")
	end

	local ok = Instance.new("TextButton")
	ok.BackgroundTransparency = 1
	ok.AnchorPoint = Vector2.new(1, 0)
	ok.Position = UDim2.new(1, -10, 0, 8)
	ok.Size = UDim2.new(0, 40, 0, 25)
	ok.Font = Enum.Font.SourceSansBold
	ok.Text = "OK"
	ok.TextSize = 18
	ok.TextColor3 = SETTINGS.AccentColor
	ok.TextTransparency = 1
	ok.TextXAlignment = Enum.TextXAlignment.Right
	ok.Parent = notif

	local message = Instance.new("TextLabel")
	message.BackgroundTransparency = 1
	message.Size = UDim2.new(1, -30, 1, -40)
	message.Position = UDim2.new(0, 15, 0, 35)
	message.Font = Enum.Font.SourceSans
	message.Text = messageText or "Custom message here"
	message.TextSize = SETTINGS.MessageSize
	message.TextColor3 = SETTINGS.MessageColor
	message.TextTransparency = 1
	message.TextWrapped = true
	message.TextXAlignment = Enum.TextXAlignment.Left
	message.TextYAlignment = Enum.TextYAlignment.Top
	message.Parent = notif

	local progressBar = Instance.new("Frame")
	progressBar.BackgroundColor3 = Color3.fromRGB(210, 210, 210)
	progressBar.BorderSizePixel = 0
	progressBar.Size = UDim2.new(1, -4, 0, 2)
	progressBar.Position = UDim2.new(0, 2, 1, -2)
	progressBar.Parent = notif

	local progressGradient = Instance.new("UIGradient", progressBar)
	progressGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.fromRGB(230, 230, 230)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(180, 180, 180))
	})

	notif.Position = UDim2.new(1, SETTINGS.Width + 20, 0, 0)

	TweenService:Create(notif, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		BackgroundTransparency = 0,
		Position = UDim2.new(0, 0, 0, 0)
	}):Play()
	TweenService:Create(title, TweenInfo.new(0.25), { TextTransparency = 0 }):Play()
	TweenService:Create(message, TweenInfo.new(0.25), { TextTransparency = 0 }):Play()
	TweenService:Create(ok, TweenInfo.new(0.25), { TextTransparency = 0 }):Play()

	local progressTween = TweenService:Create(progressBar, TweenInfo.new(duration, Enum.EasingStyle.Linear), {
		Size = UDim2.new(0, 0, 0, 2)
	})
	progressTween:Play()

	local function close()
		if notif and notif.Parent then
			progressTween:Cancel()
			TweenService:Create(notif, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
				Position = UDim2.new(1, SETTINGS.Width + 20, 0, 0),
				BackgroundTransparency = 1
			}):Play()
			TweenService:Create(title, TweenInfo.new(0.4), { TextTransparency = 1 }):Play()
			TweenService:Create(message, TweenInfo.new(0.4), { TextTransparency = 1 }):Play()
			TweenService:Create(ok, TweenInfo.new(0.4), { TextTransparency = 1 }):Play()
			TweenService:Create(progressBar, TweenInfo.new(0.3), { BackgroundTransparency = 1 }):Play()
			task.wait(0.45)
			notif:Destroy()
		end
	end

	ok.MouseButton1Click:Connect(close)
	task.delay(duration, close)
end
